(function(e){e.fn.lightbox=function(t){function r(){s();l(this);return false}function s(){e(window).bind("orientationchange",o);e(window).bind("resize",o);e("#overlay").remove();e("#lightbox").remove();n.isIE8=a();n.inprogress=false;if(n.jsonData&&n.jsonData.length>0){var t=n.jsonDataParser?n.jsonDataParser:e.fn.lightbox.parseJsonData;n.imageArray=[];n.imageArray=t(n.jsonData)}var r='<div id="outerImageContainer"><div id="imageContainer"><iframe id="lightboxIframe" /><img id="lightboxImage"><div id="hoverNav"><a href="javascript://" title="'+n.strings.prevLinkTitle+'" id="prevLink"></a><a href="javascript://" id="nextLink" title="'+n.strings.nextLinkTitle+'"></a></div><div id="loading"><a href="javascript://" id="loadingLink"><div id="jqlb_loading"></div></a></div></div></div>';var i='<div id="imageDataContainer" class="clearfix"><div id="imageData"><div id="imageDetails"><span id="caption"></span><span id="numberDisplay"></span></div><div id="pinterest"></div><div id="bottomNav">';if(n.displayHelp){i+='<span id="helpDisplay">'+n.strings.help+"</span>"}i+='<a href="javascript://" id="bottomNavClose" title="'+n.strings.closeTitle+'"><div id="jqlb_closelabel"></div></a></div></div></div>';var s;if(n.navbarOnTop){s='<div id="overlay"></div><div id="lightbox">'+i+r+"</div>";e("body").append(s);e("#imageDataContainer").addClass("ontop")}else{s='<div id="overlay"></div><div id="lightbox">'+r+i+"</div>";e("body").append(s)}e("#overlay").click(function(){w()}).hide();e("#lightbox").click(function(){w()}).hide();e("#loadingLink").click(function(){w();return false});e("#bottomNavClose").click(function(){w();return false});e("#outerImageContainer").width(n.widthCurrent).height(n.heightCurrent);e("#imageDataContainer").width(n.widthCurrent);if(!n.imageClickClose){e("#lightboxImage").click(function(){return false});e("#hoverNav").click(function(){return false})}}function o(e){if(n.resizeTimeout){clearTimeout(n.resizeTimeout);n.resizeTimeout=false}n.resizeTimeout=setTimeout(function(){d(false)},50)}function u(){var t=e(document).height();if(n.isIE8&&t>4096){t=4096}var r=e(window).height()-n.adminBarHeight;return new Array(e(document).width(),t,e(window).width(),r,e(document).height())}function a(){var e=false;if(document.createElement){var t=document.createElement("div");if(t&&t.querySelectorAll){t.innerHTML='<object><param name=""></object>';e=t.querySelectorAll("param").length!=1}t=null}return e}function f(){var t=0;var r=0;if(self.pageYOffset){r=self.pageYOffset;t=self.pageXOffset}else if(document.documentElement&&document.documentElement.scrollTop){r=document.documentElement.scrollTop;t=document.documentElement.scrollLeft}else if(document.body){r=document.body.scrollTop;t=document.body.scrollLeft}if(n.adminBarHeight&&parseInt(e("#wpadminbar").css("top"),10)===0){r+=n.adminBarHeight}return new Array(t,r)}function l(t){e("select, embed, object").hide();var r=u();var s=f();var o=0;e("#overlay").hide().css({width:r[0]+"px",height:r[1]+"px",opacity:n.overlayOpacity}).fadeIn(400);if(n.isIE8&&r[1]==4096){if(s[1]>=1e3){o=s[1]-1e3;if(r[4]-(s[1]+3096)<0){o-=s[1]+3096-r[4]}e("#overlay").css({top:o+"px"})}}imageNum=0;if(!n.jsonData){n.imageArray=[];if(!t.rel||t.rel==""){var a="";if(t.title){a=t.title}else if(e(this).children(":first-child").attr("title")){a=e(this).children(":first-child").attr("title")}n.imageArray.push(new Array(t.href,n.displayTitle?a:""))}else{e("a").each(function(){if(this.href&&this.rel==t.rel){var r="";var i="";var s="";var o=e(this);if(this.title){r=this.title}else if(o.children("img:first-child").attr("title")){r=o.children("img:first-child").attr("title")}if(o.parent().next(".gallery-caption").html()){var u=o.parent().next(".gallery-caption");i=u.html();s=u.text()}else if(o.next(".wp-caption-text").html()){i=o.next(".wp-caption-text").html();s=o.next(".wp-caption-text").text()}r=e.trim(r);s=e.trim(s);if(r.toLowerCase()==s.toLowerCase()){r=i;i=""}var a="";if(r!=""){a='<span id="titleText">'+r+"</span>"}if(i!=""){if(r!=""){a+="<br />"}a+='<span id="captionText">'+i+"</span>"}n.imageArray.push(new Array(this.href,n.displayTitle?a:""))}})}}if(n.imageArray.length>1){for(i=0;i<n.imageArray.length;i++){for(j=n.imageArray.length-1;j>i;j--){if(n.imageArray[i][0]==n.imageArray[j][0]){n.imageArray.splice(j,1)}}}while(n.imageArray[imageNum][0]!=t.href){imageNum++}}c(s[1],s[0]).show();h(imageNum)}function c(t,r){if(n.resizeSpeed>0){e("#lightbox").animate({top:t},250,"linear");return e("#lightbox").animate({left:r},250,"linear")}return e("#lightbox").css({top:t+"px",left:r+"px"})}function h(t){if(n.inprogress==false){n.inprogress=true;n.activeImage=t;e("#loading").show();e("#lightboxImage").hide();e("#hoverNav").hide();e("#prevLink").hide();e("#nextLink").hide();p()}}function p(){n.imgPreloader=new Image;n.imgPreloader.onload=function(){e("#lightboxImage").attr("src",n.imageArray[n.activeImage][0]);d();g()};n.imgPreloader.src=n.imageArray[n.activeImage][0]}function d(){if(!n.imgPreloader){return}var t=n.imgPreloader.width;var r=n.imgPreloader.height;var i=u();var s=i[2]<i[0]?i[0]:i[2];e("#overlay").css({width:s+"px",height:i[1]+"px"});var o=i[3]-(e("#imageDataContainer").height()+2*n.borderSize);var a=i[2]-2*n.borderSize;if(n.fitToScreen){var l=o-n.marginSize;var c=a-n.marginSize;var h=1;if(r>l){h=l/r}t=t*h;r=r*h;h=1;if(t>c){h=c/t}t=Math.round(t*h);r=Math.round(r*h)}var p=f();var d=p[1]+o*.5;var m=d-r*.5;var g=p[0];e("#lightboxImage").width(t).height(r);v(t,r,m,g)}function v(t,r,i,s){n.widthCurrent=e("#outerImageContainer").outerWidth();n.heightCurrent=e("#outerImageContainer").outerHeight();var o=Math.max(350,t+n.borderSize*2);var u=r+n.borderSize*2;n.xScale=o/n.widthCurrent*100;n.yScale=u/n.heightCurrent*100;c(i,s);y();e("#imageDataContainer").animate({width:o},n.resizeSpeed,"linear");e("#outerImageContainer").animate({width:o},n.resizeSpeed,"linear",function(){e("#outerImageContainer").animate({height:u},n.resizeSpeed,"linear",function(){m()})});b();e("#prevLink").height(r);e("#nextLink").height(r)}function m(){e("#imageData").show();e("#caption").show();e("#loading").hide();if(n.resizeSpeed>0){e("#lightboxImage").fadeIn("fast")}else{e("#lightboxImage").show()}n.inprogress=false}function g(){if(n.loopImages&&n.imageArray.length>1){preloadNextImage=new Image;preloadNextImage.src=n.imageArray[n.activeImage==n.imageArray.length-1?0:n.activeImage+1][0];preloadPrevImage=new Image;preloadPrevImage.src=n.imageArray[n.activeImage==0?n.imageArray.length-1:n.activeImage-1][0]}else{if(n.imageArray.length-1>n.activeImage){preloadNextImage=new Image;preloadNextImage.src=n.imageArray[n.activeImage+1][0]}if(n.activeImage>0){preloadPrevImage=new Image;preloadPrevImage.src=n.imageArray[n.activeImage-1][0]}}}function y(){e("#numberDisplay").html("");e("#caption").html("").hide();if(n.imageArray[n.activeImage][1]){e("#caption").html(n.imageArray[n.activeImage][1]).show()}var t="";var r="";var i=n.imageArray.length>1?n.strings.image+(n.activeImage+1)+n.strings.of+n.imageArray.length:"";var s=n.displayDownloadLink?'<a href="'+n.imageArray[n.activeImage][0]+'" id="downloadLink" target="'+n.linkTarget+'">'+n.strings.download+"</a>":"";var o="";if(n.imageArray.length>1&&!n.disableNavbarLinks){if(n.activeImage>0||n.loopImages){r='<a title="'+n.strings.prevLinkTitle+'" href="#" id="prevLinkText">'+n.strings.prevLinkText+"</a>"}if(n.activeImage+1<n.imageArray.length||n.loopImages){o+='<a title="'+n.strings.nextLinkTitle+'" href="#" id="nextLinkText">'+n.strings.nextLinkText+"</a>"}}t=r+t+i+s+o;if(t!=""){e("#numberDisplay").html(t).show()}if(n.pinterestPinIt&&n.imageArray[n.activeImage][1]){e("#pinterest").html('<a href="#" onclick="window.open(&#39//www.pinterest.com/pin/create/button/?url='+encodeURIComponent(n.siteURL)+"&media="+encodeURIComponent(n.imageArray[n.activeImage][0])+"&description="+encodeURIComponent(e(n.imageArray[n.activeImage][1]).text())+'&#39, &#39Hello&#39, &#39width=300,height=100&#39)" data-pin-do="buttonPin" data-pin-config="none" data-pin-height="28"><img src="//assets.pinterest.com/images/pidgets/pinit_fg_en_rect_gray_28.png" /></a>').show()}}function b(){if(n.imageArray.length>1){e("#hoverNav").show();if(n.loopImages){e("#prevLink,#prevLinkText").show().click(function(){h(n.activeImage==0?n.imageArray.length-1:n.activeImage-1);return false});e("#nextLink,#nextLinkText").show().click(function(){h(n.activeImage==n.imageArray.length-1?0:n.activeImage+1);return false})}else{if(n.activeImage!=0){e("#prevLink,#prevLinkText").show().click(function(){h(n.activeImage-1);return false})}if(n.activeImage!=n.imageArray.length-1){e("#nextLink,#nextLinkText").show().click(function(){h(n.activeImage+1);return false})}}S()}}function w(){x();e("#lightbox").hide();e("#overlay").fadeOut();e("select, object, embed").show()}function E(e){var t=e.data.opts;var r=e.keyCode;var i=27;var s=String.fromCharCode(r).toLowerCase();if(s=="x"||s=="o"||s=="c"||r==i){w()}else if(s=="p"||r==37){if(t.loopImages){x();h(t.activeImage==0?t.imageArray.length-1:t.activeImage-1)}else if(t.activeImage!=0){x();h(t.activeImage-1)}}else if(s=="n"||r==39){if(n.loopImages){x();h(t.activeImage==t.imageArray.length-1?0:t.activeImage+1)}else if(t.activeImage!=t.imageArray.length-1){x();h(t.activeImage+1)}}return false}function S(){e(document).bind("keydown",{opts:n},E)}function x(){e(document).unbind("keydown")}var n=e.extend({},e.fn.lightbox.defaults,t);if(parseFloat(e().jquery)>=1.7){return e(this).on("click",r)}else{return e(this).live("click",r)}};e.fn.lightbox.parseJsonData=function(t){var n=[];e.each(t,function(){n.push(new Array(this.url,this.title))});return n};e.fn.lightbox.defaults={adminBarHeight:28,overlayOpacity:.8,borderSize:10,imageArray:new Array,activeImage:null,inprogress:false,widthCurrent:250,heightCurrent:250,xScale:1,yScale:1,displayTitle:true,disableNavbarLinks:true,loopImages:true,imageClickClose:true,jsonData:null,jsonDataParser:null,followScroll:false,isIE8:false};e(document).ready(function(e){var t=typeof JQLBSettings=="object";if(t&&JQLBSettings.resizeSpeed){JQLBSettings.resizeSpeed=parseInt(JQLBSettings.resizeSpeed)}if(t&&JQLBSettings.marginSize){JQLBSettings.marginSize=parseInt(JQLBSettings.marginSize)}var n={help:" Browse images with your keyboard: Arrows or P(revious)/N(ext) and X/C/ESC for close.",prevLinkTitle:"previous image",nextLinkTitle:"next image",prevLinkText:"&laquo; Previous",nextLinkText:"Next &raquo;",closeTitle:"close image gallery",image:"Image ",of:" of ",download:"Download"};e('a[rel^="lightbox"]').lightbox({adminBarHeight:e("#wpadminbar").height()||0,linkTarget:t&&JQLBSettings.linkTarget.length?JQLBSettings.linkTarget:"_self",displayHelp:t&&JQLBSettings.help.length?true:false,marginSize:t&&JQLBSettings.marginSize?JQLBSettings.marginSize:0,fitToScreen:t&&JQLBSettings.fitToScreen=="1"?true:false,resizeSpeed:t&&JQLBSettings.resizeSpeed>=0?JQLBSettings.resizeSpeed:400,displayDownloadLink:t&&JQLBSettings.displayDownloadLink=="0"?false:true,navbarOnTop:t&&JQLBSettings.navbarOnTop=="0"?false:true,pinterestPinIt:t&&JQLBSettings.pinterestPinIt=="1"?true:false,siteURL:t&&JQLBSettings.siteURL?JQLBSettings.siteURL:"",strings:t&&typeof JQLBSettings.help=="string"?JQLBSettings:n})})})(jQuery)